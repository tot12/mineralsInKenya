<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        .canvas-point-item{
            position:absolute;
            width:10px;
            height:10px;
            margin-left:-5px;
            margin-top:-5px;
            border-radius: 50%;
            background-color: #0cf;
            border:1px solid #008fb3;
            opacity:.5;
        }
        .canvas-point-item:hover{
            background-color: #fc0;
            z-index:999999;
            cursor:pointer;
            cursor:hand;
            opacity:1;
        }

    </style>
</head>
<body>
<svg style ="height:80vh;margin:10%"> </svg>
</body>
<!--<script src="../bootstrap/d3v5.15.1.js"></script>-->
<script src="https://d3js.org/d3.v7.min.js"></script>
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.7.0/d3.min.js"></script>-->
<script src="../bootstrap/jquery-3.5.1.js"></script>
<script>
    var svg = d3.select("svg")
        //movable graph
        .call(d3.zoom().on("zoom", function () {
            svg.attr("transform", d3.event.transform)
        }))
        .append("g")

    width = +svg.node().getBoundingClientRect().width
    height = +svg.node().getBoundingClientRect().height;
    var datapoints;

    fetch("/file")
        .then(response => response.json())
        .then(jsonData => {
            console.log("Printing fetched jsonFile here:", jsonData)
            displaydatapoints(jsonData);
            datapoints=jsonData
        })
        .catch(error => {
            console.log('Error fetching data:', error);
        });

    function displaydatapoints(datapoint){
    console.log("datapoint:",datapoint.addresses)
        var outsidedata =datapoint
        d3.json("/crzonesfile")
            .then(function(data) {
                console.log("crzones",data)
                const projection = d3.geoMercator()
                    //.center([, ]) // Set the center coordinates of the map
                    .scale(10000) // Adjust the scale to fit the map nicely
                    .translate([width / 2, height / 2]);
               // const svg = d3.select("#map");
                const path = d3.geoPath().projection(projection);
                /*data.features.forEach(function(feature) {
                    if(feature.geometry.type === "MultiPolygon") {
                        feature.geometry.coordinates.forEach(function(polygon) {
                            polygon.forEach(function(ring) {
                                ring.reverse();
                            })
                        })
                    }
                })*/
                //doesnt draw anything
                /*var projection = d3.geoIdentity().fitSize([width,height],data)
                var path = d3.geoPath(projection);

                svg.selectAll("path")
                    .data(data.features)
                    .enter()
                    .append("path")
                    .attr("d", path)
                    .style("fill", "steelblue")
                    .style("stroke", "white");*/

                //n/b : i know the addresses exist
                //so its just a matter of adding the points
                //to the zones
                var filteredadd=[]
                outsidedata.addresses.forEach(function(m){
                    filteredadd.push({features:m.features})
                })
                /*var coll ={"type": "FeatureCollection",
                    "crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:OGC:1.3:CRS84" } },
                    "features":filteredadd}*/
                const pathGenerator = d3.geoPath().projection(projection);
                svg.selectAll("path")
                    .data(data.features)
                    .enter()
                    .append("path")
                    .attr("d", pathGenerator)
                    //.style("fill", "steelblue")
                    .style("stroke", "black");
                //svg.append("g").selectAll("path").data(data).enter().append("path").attr("d",pathGenerator)

                var feature = svg.selectAll("div")
                    .data(outsidedata.features)
                    .enter()
                    .append("div")
                    .attr("class","canvas-point-item");


            })
            .catch(function(error) {
                // Error occurred while loading the data
                console.error(error);
            });

    }

</script>

</html>